{% extends 'myapp/base.html' %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/theme/monokai.min.css">
<link rel="stylesheet" href="{% static 'myapp/css/test_detail.css' %}">
{% endblock %}

{% block content %}
<div class="container">
    <div class="timer" id="timer" data-time-limit="{{ test.time_limit_minutes }}">
        <div>‚è±Ô∏è –û—Å—Ç–∞–ª–æ—Å—å –≤—Ä–µ–º–µ–Ω–∏</div>
        <div class="timer-value" id="timer-value"></div>
    </div>

    <div class="test-header">
        <h1>{{ test.title }}</h1>
        <p>{{ test.description }}</p>
    </div>

    <form method="post" action="{% url 'submit_test' test.pk %}" id="test-form">
        {% csrf_token %}
        
        {% for question in questions %}
        <div class="question-card">
            <div class="question-text">
                <span class="question-number">{{ forloop.counter }}</span>
                <span>{{ question.text }}</span>
                {% if question.question_type == 'code' %}
                <span class="question-type-badge badge-code">üíª –ó–ê–î–ê–ß–ê –ü–û –ü–†–û–ì–†–ê–ú–ú–ò–†–û–í–ê–ù–ò–Æ</span>
                {% endif %}
            </div>
            
            {% if question.question_type == 'single' %}
                <ul class="answers-list">
                    {% for answer in question.answers.all %}
                    <li class="answer-item">
                        <input 
                            type="radio" 
                            name="question_{{ question.pk }}" 
                            value="{{ answer.pk }}" 
                            id="answer-{{ answer.pk }}"
                            required
                        >
                        <label for="answer-{{ answer.pk }}" class="answer-label">
                            {{ answer.text }}
                        </label>
                    </li>
                    {% endfor %}
                </ul>
            {% elif question.question_type == 'code' %}
                <div class="code-editor-wrapper">
                    <textarea 
                        id="code-{{ question.pk }}" 
                        name="code_{{ question.pk }}"
                        class="code-editor"
                        required
                    >{{ question.code_template|default:"# –ù–∞–ø–∏—à–∏—Ç–µ –≤–∞—à –∫–æ–¥ –∑–¥–µ—Å—å\n" }}</textarea>
                </div>
                {% if question.expected_output %}
                <div class="expected-output">
                    <strong>–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:</strong>
                    <pre style="margin-top: 0.5rem; font-family: monospace;">{{ question.expected_output }}</pre>
                </div>
                {% endif %}
            {% endif %}
        </div>
        {% endfor %}

        <div class="submit-section">
            <div class="progress-bar">
                <div class="progress-fill" id="progress-fill" style="width: 0%"></div>
            </div>
            <p id="progress-text" data-total="{{ questions.count }}">–û—Ç–≤–µ—á–µ–Ω–æ –Ω–∞ 0 –∏–∑ {{ questions.count }} –≤–æ–ø—Ä–æ—Å–æ–≤</p>
            <button type="submit" class="btn btn-success">
                ‚úÖ –ó–∞–≤–µ—Ä—à–∏—Ç—å —Ç–µ—Å—Ç
            </button>
        </div>
    </form>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/python/python.min.js"></script>
{% endblock %}

{% block extra_js %}
<script src="{% static 'myapp/js/test_detail.js' %}"></script>
{% endblock %}