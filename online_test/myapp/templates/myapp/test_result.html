{% extends 'myapp/base.html' %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'myapp/css/test_result.css' %}">
{% endblock %}

{% block content %}
<div class="result-container">
    <div class="result-card">
        {% if result.percentage_score >= 80 %}
            <div class="result-icon">üéâ</div>
            <h1 class="result-title">–û—Ç–ª–∏—á–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç!</h1>
        {% elif result.percentage_score >= 60 %}
            <div class="result-icon">üëç</div>
            <h1 class="result-title">–•–æ—Ä–æ—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç!</h1>
        {% elif result.percentage_score >= 40 %}
            <div class="result-icon">üìö</div>
            <h1 class="result-title">–ù–µ–ø–ª–æ—Ö–æ!</h1>
        {% else %}
            <div class="result-icon">üí™</div>
            <h1 class="result-title">–ï—Å—Ç—å –Ω–∞–¥ —á–µ–º —Ä–∞–±–æ—Ç–∞—Ç—å</h1>
        {% endif %}
        
        <p class="result-subtitle">{{ test.title }}</p>

        <div class="score-display">
            <div class="score-circle" data-percentage="{{ result.percentage_score }}">
                <svg width="200" height="200">
                    <defs>
                        <linearGradient id="gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#667eea;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#764ba2;stop-opacity:1" />
                        </linearGradient>
                    </defs>
                    <circle class="score-circle-bg" cx="100" cy="100" r="90"></circle>
                    <circle class="score-circle-fill" cx="100" cy="100" r="90"></circle>
                </svg>
                <div class="score-text">
                    {{ result.percentage_score|floatformat:0 }}
                    <span class="score-percentage">%</span>
                </div>
            </div>
        </div>

        <div class="stats-grid">
            <div class="stat-item">
                <span class="stat-value">{{ result.score }}</span>
                <span class="stat-label">–ü—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤</span>
            </div>
            <div class="stat-item">
                <span class="stat-value">{{ result.total_questions }}</span>
                <span class="stat-label">–í—Å–µ–≥–æ –≤–æ–ø—Ä–æ—Å–æ–≤</span>
            </div>
            <div class="stat-item">
                <span class="stat-value">{{ result.timestamp|date:"H:i" }}</span>
                <span class="stat-label">–í—Ä–µ–º—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è</span>
            </div>
        </div>

        {% if result.percentage_score >= 80 %}
        <div class="result-message excellent">
            üåü –ü—Ä–µ–≤–æ—Å—Ö–æ–¥–Ω–æ! –í—ã –ø—Ä–æ–¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä–æ–≤–∞–ª–∏ –æ—Ç–ª–∏—á–Ω–æ–µ –∑–Ω–∞–Ω–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª–∞. –ü—Ä–æ–¥–æ–ª–∂–∞–π—Ç–µ –≤ —Ç–æ–º –∂–µ –¥—É—Ö–µ!
        </div>
        {% elif result.percentage_score >= 60 %}
        <div class="result-message good">
            ‚ú® –•–æ—Ä–æ—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç! –£ –≤–∞—Å —Å–æ–ª–∏–¥–Ω–∞—è –±–∞–∑–∞ –∑–Ω–∞–Ω–∏–π. –ù–µ–º–Ω–æ–≥–æ –ø—Ä–∞–∫—Ç–∏–∫–∏ - –∏ –≤—ã —Å—Ç–∞–Ω–µ—Ç–µ —ç–∫—Å–ø–µ—Ä—Ç–æ–º!
        </div>
        {% elif result.percentage_score >= 40 %}
        <div class="result-message average">
            üìñ –ù–µ–ø–ª–æ—Ö–æ–µ –Ω–∞—á–∞–ª–æ! –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º –ø–æ–≤—Ç–æ—Ä–∏—Ç—å –º–∞—Ç–µ—Ä–∏–∞–ª –∏ –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –µ—â–µ —Ä–∞–∑.
        </div>
        {% else %}
        <div class="result-message poor">
            üí° –ù–µ —Ä–∞—Å—Å—Ç—Ä–∞–∏–≤–∞–π—Ç–µ—Å—å! –≠—Ç–æ –æ—Ç–ª–∏—á–Ω–∞—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –¥–ª—è –æ–±—É—á–µ–Ω–∏—è. –ò–∑—É—á–∏—Ç–µ –º–∞—Ç–µ—Ä–∏–∞–ª –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞!
        </div>
        {% endif %}

        <div class="actions">
            <a href="{% url 'test_list' %}" class="btn btn-primary">
                üè† –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Ç–µ—Å—Ç–∞–º
            </a>
            <a href="{% url 'test_detail' test.pk %}" class="btn btn-secondary">
                üîÑ –ü—Ä–æ–π—Ç–∏ –µ—â–µ —Ä–∞–∑
            </a>
        </div>

        {% if code_submissions %}
        <div class="code-details">
            <h2>üíª –í–∞—à–∏ —Ä–µ—à–µ–Ω–∏—è –∑–∞–¥–∞—á –ø–æ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—é</h2>
            
            {% for submission in code_submissions %}
            <div class="code-submission {% if submission.is_correct %}correct{% else %}incorrect{% endif %}">
                <div class="code-submission-header">
                    <h3>{{ submission.question.text|truncatewords:10 }}</h3>
                    <span class="code-status {% if submission.is_correct %}correct{% else %}incorrect{% endif %}">
                        {% if submission.is_correct %}‚úÖ –í–µ—Ä–Ω–æ{% else %}‚ùå –ù–µ–≤–µ—Ä–Ω–æ{% endif %}
                    </span>
                </div>
                
                <span class="output-label">–í–∞—à –∫–æ–¥:</span>
                <div class="code-block">
                    <pre>{{ submission.code }}</pre>
                </div>
                
                <span class="output-label">–†–µ–∑—É–ª—å—Ç–∞—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:</span>
                <div class="code-block">
                    <pre>{{ submission.output|default:"–ù–µ—Ç –≤—ã–≤–æ–¥–∞" }}</pre>
                </div>
                
                {% if submission.question.expected_output %}
                <span class="output-label">–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:</span>
                <div class="code-block">
                    <pre>{{ submission.question.expected_output }}</pre>
                </div>
                {% endif %}
            </div>
            {% endfor %}
        </div>
        {% endif %}
    </div>
</div>

<script>
    (function() {
        // –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è –∫—Ä—É–≥–∞
        document.addEventListener('DOMContentLoaded', function() {
            const scoreCircle = document.querySelector('.score-circle');
            const percentage = parseFloat(scoreCircle.getAttribute('data-percentage'));
            const circle = document.querySelector('.score-circle-fill');
            const circumference = 565;
            const offset = circumference - (circumference * percentage / 100);
            
            setTimeout(function() {
                circle.style.strokeDashoffset = offset;
            }, 200);
        });
    })();
</script>
{% endblock %}